=================================================================
üß™ COMANDOS DE PRUEBA R√ÅPIDA - HACKLESS TFG PROTOTIPO
=================================================================

// ========================================
// üöÄ 1. INICIALIZACI√ìN
// ========================================

cd "c:\Users\pc\proyectos Vero\Hackless-TFG-Prototipo"
node app.js

// ========================================
// üîê 2. AUTENTICACI√ìN B√ÅSICA  
// ========================================

// A) Registrar usuario administrador:
Invoke-WebRequest -Uri "http://localhost:3000/api/auth/register" -Method POST -ContentType "application/json" -Body '{"nombre":"Test Admin","correo_electronico":"admin@test.com","password":"Admin123!","rol":"administrador"}'

// B) Login para obtener token:
$response = Invoke-WebRequest -Uri "http://localhost:3000/api/auth/login" -Method POST -ContentType "application/json" -Body '{"correo_electronico":"admin@test.com","password":"Admin123!"}'
$loginData = $response.Content | ConvertFrom-Json
$token = $loginData.access_token
Write-Host "Token obtenido: $token"

// ========================================
// üìä 3. PRUEBAS DE DASHBOARD
// ========================================

// Configurar headers con token:
$headers = @{
    "Authorization" = "Bearer $token"
    "Content-Type" = "application/json"
}

// Obtener m√©tricas del dashboard:
Invoke-WebRequest -Uri "http://localhost:3000/api/metrics/dashboard" -Headers $headers

// Obtener reporte de seguridad:
Invoke-WebRequest -Uri "http://localhost:3000/api/metrics/security-report" -Headers $headers

// ========================================
// üé£ 4. PRUEBAS DE PHISHING
// ========================================

// A) Crear campa√±a:
$campaignBody = @{
    nombre_campana = "Test Banking"
    template_usado = "banco_falso" 
    destinatarios = @("emp1@test.com", "emp2@test.com")
    descripcion = "Prueba de phishing bancario"
} | ConvertTo-Json

$campaignResponse = Invoke-WebRequest -Uri "http://localhost:3000/api/phishing/crear-campana" -Method POST -Headers $headers -Body $campaignBody
$campaignData = $campaignResponse.Content | ConvertFrom-Json
$campaignId = $campaignData.campana.id
Write-Host "Campa√±a ID: $campaignId"

// B) Iniciar campa√±a:
Invoke-WebRequest -Uri "http://localhost:3000/api/phishing/iniciar-campana/$campaignId" -Method POST -Headers $headers

// C) Ver estad√≠sticas:
Invoke-WebRequest -Uri "http://localhost:3000/api/phishing/estadisticas/$campaignId" -Headers $headers

// ========================================
// üñ•Ô∏è 5. ACCESO A FRONTEND
// ========================================

// Abrir en navegador:
start "http://localhost:3000/dashboard-metricas.html"
start "http://localhost:3000/simulador-phishing.html" 
start "http://localhost:3000/test-jwt.html"

// ========================================
// üîí 6. PRUEBAS DE SEGURIDAD
// ========================================

// A) Acceso sin token (debe fallar):
try {
    Invoke-WebRequest -Uri "http://localhost:3000/api/metrics/dashboard"
} catch {
    Write-Host "‚úÖ CORRECTO: Acceso denegado sin token"
}

// B) Token inv√°lido (debe fallar):
$badHeaders = @{
    "Authorization" = "Bearer token_falso"
    "Content-Type" = "application/json"
}
try {
    Invoke-WebRequest -Uri "http://localhost:3000/api/metrics/dashboard" -Headers $badHeaders
} catch {
    Write-Host "‚úÖ CORRECTO: Token inv√°lido rechazado"
}

// ========================================
// üìã CHECKLIST DE VERIFICACI√ìN
// ========================================

ANTES DE EMPEZAR:
‚ñ° XAMPP iniciado con MySQL corriendo
‚ñ° Base de datos 'hackless_db' creada
‚ñ° Dependencias instaladas (npm install)
‚ñ° Servidor Node.js corriendo en puerto 3000

PRUEBAS PRINCIPALES:
‚ñ° Registro de usuario exitoso
‚ñ° Login JWT obtiene token v√°lido
‚ñ° Dashboard de m√©tricas responde con datos
‚ñ° Campa√±a phishing se crea correctamente
‚ñ° Endpoints protegidos requieren autenticaci√≥n
‚ñ° Frontend es accesible desde navegador
‚ñ° Gr√°ficos Chart.js se renderizan correctamente

FUNCIONALIDADES CLAVE:
‚ñ° Autenticaci√≥n JWT con bcrypt
‚ñ° Simulaciones de phishing con tracking
‚ñ° Dashboard interactivo con m√©tricas
‚ñ° Control de acceso por roles
‚ñ° Interfaz responsive y profesional

=================================================================
üéØ DATOS DE EJEMPLO PARA PRUEBAS
=================================================================

USUARIO ADMINISTRADOR:
- Email: admin@test.com
- Password: Admin123!
- Rol: administrador

USUARIO EMPLEADO:
- Email: empleado@test.com  
- Password: Emp123!
- Rol: empleado

CAMPA√ëA DE PHISHING:
- Nombre: "Simulaci√≥n Bancaria Q4"
- Template: "banco_falso"
- Destinatarios: ["juan@empresa.com", "maria@empresa.com"]
- Descripci√≥n: "Evaluaci√≥n de conciencia en seguridad"

=================================================================
üöÄ SCRIPT AUTOMATIZADO
=================================================================

Para ejecutar todas las pruebas autom√°ticamente:
.\test-hackless.ps1

Con par√°metros espec√≠ficos:
.\test-hackless.ps1 -BaseUrl "http://localhost:3000" -TestUser "admin@test.com"

=================================================================
üìä ENDPOINTS PRINCIPALES
=================================================================

AUTENTICACI√ìN:
POST /api/auth/register    - Registrar usuario
POST /api/auth/login       - Login con JWT
POST /api/auth/refresh     - Renovar token

PHISHING:
POST /api/phishing/crear-campana        - Crear campa√±a
POST /api/phishing/iniciar-campana/:id  - Iniciar campa√±a  
GET  /api/phishing/estadisticas/:id     - Ver estad√≠sticas
GET  /phishing/capture/:token           - Capturar click

M√âTRICAS:
GET  /api/metrics/dashboard             - KPIs generales
GET  /api/metrics/campaign/:id          - M√©tricas espec√≠ficas
GET  /api/metrics/security-report       - Reporte ejecutivo

FRONTEND:
GET  /                                  - Homepage
GET  /dashboard-metricas.html          - Dashboard visual
GET  /simulador-phishing.html          - Simulador UI
GET  /test-jwt.html                    - Test autenticaci√≥n

=================================================================